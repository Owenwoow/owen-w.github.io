# 00-日志审查

在 Linux 中筛选和突出显示日志文件中的特定内容涉及多个知识点和命令的组合使用。以下是关键知识点的总结：

### 1. 使用 `grep` 命令

`grep` 是一个强大的文本搜索工具，可以用于在文件中查找和筛选特定的模式。

- **基本用法**：

  ```sh
  grep 'pattern' filename
  ```

  查找文件中包含特定模式的行。

- **排除匹配项**：

  ```sh
  grep -v 'pattern' filename
  ```

  使用 `-v` 选项来反转匹配，即只输出不包含指定模式的行。

### 2. 使用 `awk` 命令

`awk` 是一个强大的文本处理工具，适用于模式扫描和处理。

- **基本用法**：

  ```sh
  awk 'pattern { action }' filename
  ```

  根据模式匹配执行指定的动作。

- **全局替换**：

  ```sh
  awk '{ gsub(/regex/, "replacement"); print }' filename
  ```

  使用 `gsub` 函数进行全局替换，将匹配正则表达式 `regex` 的内容替换为 `replacement`。

### 3. ANSI 转义码

ANSI 转义码用于在终端中产生各种文本效果（如颜色、高亮）。

- **基本格式**：

  ```sh
  \033[<code>m
  ```

  `\033` 是转义序列，`[<code>m` 是控制码。例如，`31` 是红色，`1` 是粗体，`0` 是重置。

### 4. 综合使用 `grep` 和 `awk`

结合使用 `grep` 和 `awk` 可以实现更复杂的文本处理任务。

- **示例：过滤不包含特定 IP 的行并突出显示 IP 地址**：

  ```sh
  grep -v '148.135.103.83' example.log | awk '{gsub(/[0-9]+\.[0-9]+\.[0-9]+\.[0-9]+/, "\033[1;31m&\033[0m"); print}'
  ```

### 5. 解释示例命令

- **过滤掉包含特定 IP 的行**：

  ```sh
  grep -v '148.135.103.83' example.log
  ```

  `grep -v` 用于排除包含 `148.135.103.83` 的行。

- **突出显示 IP 地址**：

  ```sh
  awk '{gsub(/[0-9]+\.[0-9]+\.[0-9]+\.[0-9]+/, "\033[1;31m&\033[0m"); print}'
  ```

  `awk` 使用 `gsub` 函数将匹配 IP 地址的部分替换为带有 ANSI 转义码（红色）的字符串，然后输出处理后的行。

### 6. 完整示例命令

将上述步骤合并成一个完整命令：

```sh
grep -v '148.135.103.83' example.log | awk '{gsub(/[0-9]+\.[0-9]+\.[0-9]+\.[0-9]+/, "\033[1;31m&\033[0m"); print}'
```

### 7. 结果

执行上述命令后，输出会显示不包含 `148.135.103.83` 的日志行，并且其中的 IP 地址将以红色突出显示：

```sh
2024-10-08 12:00:01,123 INFO [1;31m148.135.103.82[0m - Access from [1;31m148.135.103.82[0m
2024-10-08 12:02:03,789 INFO [1;31m148.135.103.84[0m - Access from [1;31m148.135.103.84[0m
```

这种方法可以帮助你有效地筛选和突出显示日志文件中的特定内容。通过掌握 `grep`、`awk` 和 ANSI 转义码的使用，你可以更灵活地处理和分析日志文件。